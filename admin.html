<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠçŸ¥ã‚‰ã›ç®¡ç† | pol</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&family=Noto+Sans+JP:wght@300;400;500&family=Noto+Serif+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="images/pol_logo.JPG" type="image/png">
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container {
            max-width: 900px;
            margin: 120px auto 50px;
            padding: 40px;
            background: var(--color-white);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--color-secondary);
        }

        .admin-header h1 {
            color: var(--color-primary);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .admin-header p {
            color: var(--color-text);
            opacity: 0.7;
        }

        .add-news-section {
            background: linear-gradient(135deg, rgba(232, 220, 196, 0.3) 0%, rgba(212, 165, 154, 0.2) 100%);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 40px;
        }

        .add-news-section h2 {
            color: var(--color-primary);
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .news-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .news-input-group input {
            flex: 1;
        }

        .news-list-section h2 {
            color: var(--color-primary);
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .admin-news-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border: 1px solid #E8DCC4;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: var(--transition-base);
        }

        .admin-news-item:hover {
            background: rgba(232, 220, 196, 0.2);
        }

        .admin-news-info {
            flex: 1;
        }

        .admin-news-date {
            font-weight: 700;
            color: var(--color-primary);
            margin-right: 15px;
        }

        .admin-news-content {
            color: var(--color-text);
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .btn-delete:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn-download {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
            display: block;
            margin: 30px auto 0;
        }

        .btn-download:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .instruction-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }

        .instruction-box h3 {
            color: #856404;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .instruction-box ol {
            margin-left: 20px;
            color: #856404;
        }

        .instruction-box li {
            margin-bottom: 8px;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: var(--color-primary);
            text-decoration: underline;
        }

        .back-link:hover {
            color: var(--color-text);
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>ğŸ“¢ ãŠçŸ¥ã‚‰ã›ç®¡ç†</h1>
            <p>ãŠçŸ¥ã‚‰ã›ã®è¿½åŠ ãƒ»å‰Šé™¤ã‚’è¡Œãˆã¾ã™</p>
        </div>

        <div class="add-news-section">
            <h2>æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ã‚’è¿½åŠ </h2>
            <div class="news-input-group">
                <input type="date" id="news-date" class="form-input">
                <input type="text" id="news-content" class="form-input" placeholder="ãŠçŸ¥ã‚‰ã›ã®å†…å®¹ã‚’å…¥åŠ›">
            </div>
            <button onclick="addNewsItem()" class="btn btn-primary">è¿½åŠ </button>
        </div>

        <div class="news-list-section">
            <h2>ç¾åœ¨ã®ãŠçŸ¥ã‚‰ã›ä¸€è¦§</h2>
            <div id="admin-news-list">
                <p style="text-align: center; color: #999;">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <button onclick="downloadNewsJSON()" class="btn-download">ğŸ“¥ news.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

        <div class="instruction-box">
            <h3>ğŸ’¡ ä½¿ã„æ–¹</h3>
            <ol>
                <li>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ã‚’è¿½åŠ ã§ãã¾ã™</li>
                <li>ä¸è¦ãªãŠçŸ¥ã‚‰ã›ã¯ã€Œå‰Šé™¤ã€ãƒœã‚¿ãƒ³ã§å‰Šé™¤ã§ãã¾ã™</li>
                <li>å¤‰æ›´ãŒå®Œäº†ã—ãŸã‚‰ã€Œnews.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã®<code>news.json</code>ã¨ç½®ãæ›ãˆã¦ãã ã•ã„</li>
                <li>ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¾ã™</li>
            </ol>
        </div>

        <a href="index.html" class="back-link">â† ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

    <script>
        const STORAGE_KEY = 'pol_news_data';
        let newsData = [];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãŠçŸ¥ã‚‰ã›ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        document.addEventListener('DOMContentLoaded', async () => {
            await loadNewsData();

            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®š
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('news-date').value = today;
        });

        // ãŠçŸ¥ã‚‰ã›ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        async function loadNewsData() {
            try {
                // ã¾ãšãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
                const storedData = localStorage.getItem(STORAGE_KEY);

                if (storedData) {
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
                    newsData = JSON.parse(storedData);
                    console.log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãŠçŸ¥ã‚‰ã›ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                } else {
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
                    const timestamp = new Date().getTime();
                    const response = await fetch(`news.json?t=${timestamp}`, {
                        cache: 'no-store'
                    });
                    newsData = await response.json();
                    // åˆå›èª­ã¿è¾¼ã¿æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    saveToLocalStorage();
                    console.log('news.jsonã‹ã‚‰ãŠçŸ¥ã‚‰ã›ã‚’èª­ã¿è¾¼ã¿ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¾ã—ãŸ');
                }

                renderNewsList();
            } catch (error) {
                console.error('ãŠçŸ¥ã‚‰ã›ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('admin-news-list').innerHTML =
                    '<p style="text-align: center; color: #e74c3c;">ãŠçŸ¥ã‚‰ã›ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveToLocalStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(newsData));
                console.log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // ãŠçŸ¥ã‚‰ã›ä¸€è¦§ã‚’è¡¨ç¤º
        function renderNewsList() {
            const listElement = document.getElementById('admin-news-list');

            if (newsData.length === 0) {
                listElement.innerHTML = '<p style="text-align: center; color: #999;">ãŠçŸ¥ã‚‰ã›ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            listElement.innerHTML = newsData.map((news, index) => `
                <div class="admin-news-item">
                    <div class="admin-news-info">
                        <span class="admin-news-date">${news.date}</span>
                        <span class="admin-news-content">${news.content}</span>
                    </div>
                    <button class="btn-delete" onclick="deleteNewsItem(${index})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        // ãŠçŸ¥ã‚‰ã›ã‚’è¿½åŠ 
        function addNewsItem() {
            const dateInput = document.getElementById('news-date');
            const contentInput = document.getElementById('news-content');

            const date = dateInput.value;
            const content = contentInput.value.trim();

            if (!date || !content) {
                alert('æ—¥ä»˜ã¨å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // æ—¥ä»˜ã‚’YYYY.MM.DDå½¢å¼ã«å¤‰æ›
            const formattedDate = date.replace(/-/g, '.');

            // æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ã‚’é…åˆ—ã®å…ˆé ­ã«è¿½åŠ 
            newsData.unshift({
                date: formattedDate,
                content: content
            });

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            saveToLocalStorage();

            // è¡¨ç¤ºã‚’æ›´æ–°
            renderNewsList();

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            contentInput.value = '';

            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’å†è¨­å®š
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;

            alert('ãŠçŸ¥ã‚‰ã›ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼\nå¤‰æ›´ã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚');
        }

        // ãŠçŸ¥ã‚‰ã›ã‚’å‰Šé™¤
        function deleteNewsItem(index) {
            if (!confirm('ã“ã®ãŠçŸ¥ã‚‰ã›ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
                return;
            }

            newsData.splice(index, 1);

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            saveToLocalStorage();

            renderNewsList();

            alert('ãŠçŸ¥ã‚‰ã›ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼\nå¤‰æ›´ã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚');
        }

        // news.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰
        function downloadNewsJSON() {
            const jsonStr = JSON.stringify(newsData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'news.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('news.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚\nãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚');
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        function resetLocalStorage() {
            if (confirm('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã€news.jsonã‹ã‚‰å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }
    </script>
</body>

</html>