<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠçŸ¥ã‚‰ã›ç®¡ç† | pol</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&family=Noto+Sans+JP:wght@300;400;500&family=Noto+Serif+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="images/pol_logo.JPG" type="image/png">
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container {
            max-width: 900px;
            margin: 120px auto 50px;
            padding: 40px;
            background: var(--color-white);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--color-secondary);
        }

        .admin-header h1 {
            color: var(--color-primary);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .admin-header p {
            color: var(--color-text);
            opacity: 0.7;
        }

        .add-news-section {
            background: linear-gradient(135deg, rgba(232, 220, 196, 0.3) 0%, rgba(212, 165, 154, 0.2) 100%);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 40px;
        }

        .add-news-section h2 {
            color: var(--color-primary);
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .news-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .news-input-group input {
            flex: 1;
        }

        .news-list-section h2 {
            color: var(--color-primary);
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .admin-news-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border: 1px solid #E8DCC4;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: var(--transition-base);
        }

        .admin-news-item:hover {
            background: rgba(232, 220, 196, 0.2);
        }

        .admin-news-info {
            flex: 1;
        }

        .admin-news-date {
            font-weight: 700;
            color: var(--color-primary);
            margin-right: 15px;
        }

        .admin-news-content {
            color: var(--color-text);
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .btn-delete:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn-download {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
            display: block;
            margin: 30px auto 0;
        }

        .btn-download:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .instruction-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }

        .instruction-box h3 {
            color: #856404;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .instruction-box ol {
            margin-left: 20px;
            color: #856404;
        }

        .instruction-box li {
            margin-bottom: 8px;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: var(--color-primary);
            text-decoration: underline;
        }

        .back-link:hover {
            color: var(--color-text);
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>ğŸ“¢ ãŠçŸ¥ã‚‰ã›ç®¡ç†</h1>
            <p>ãŠçŸ¥ã‚‰ã›ã®è¿½åŠ ãƒ»å‰Šé™¤ã‚’è¡Œãˆã¾ã™</p>
        </div>

        <div class="add-news-section" style="background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);">
            <h2>ğŸ†• ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æƒ…å ±ã®è¿½åŠ </h2>
            <div class="news-input-group">
                <input type="date" id="event-date" class="form-input">
                <input type="text" id="event-content" class="form-input" placeholder="ã‚¤ãƒ™ãƒ³ãƒˆå†…å®¹ã‚’å…¥åŠ›...">
            </div>
            <button onclick="addEventItem()" class="btn btn-primary" style="background-color: #00897b;">è¿½åŠ 
                (ã‚¤ãƒ™ãƒ³ãƒˆ)</button>
        </div>

        <div class="news-list-section">
            <h2>ğŸ‰ ç¾åœ¨ã®ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</h2>
            <div id="admin-event-list"></div>
        </div>

        <button onclick="downloadJSON(eventData, 'event_news.json')" class="btn-download"
            style="background: #00897b; margin-bottom: 50px;">ğŸ“¥ event_news.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

        <hr style="margin: 40px 0; border: 0; border-top: 2px dashed #ccc;">

        <div class="add-news-section">
            <h2>ğŸ“° æ›´æ–°è¨˜éŒ²ã®è¿½åŠ </h2>
            <div class="news-input-group">
                <input type="date" id="news-date" class="form-input">
                <input type="text" id="news-content" class="form-input" placeholder="æ›´æ–°å†…å®¹ã‚’å…¥åŠ›...">
            </div>
            <button onclick="addNewsItem()" class="btn btn-primary">è¿½åŠ  (æ›´æ–°è¨˜éŒ²)</button>
        </div>

        <div class="news-list-section">
            <h2>ğŸ“œ ç¾åœ¨ã®æ›´æ–°è¨˜éŒ²</h2>
            <div id="admin-news-list">
                <p style="text-align: center; color: #999;">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <button onclick="downloadJSON(newsData, 'news.json')" class="btn-download">ğŸ“¥ news.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

        <div class="instruction-box">
            <h3>ğŸ’¡ ä½¿ã„æ–¹</h3>
            <ol>
                <li>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã€Œã‚¤ãƒ™ãƒ³ãƒˆã€ã¾ãŸã¯ã€Œæ›´æ–°è¨˜éŒ²ã€ã‚’è¿½åŠ ã§ãã¾ã™</li>
                <li>ãã‚Œãã‚Œç‹¬ç«‹ã—ã¦ç®¡ç†ã•ã‚Œã¾ã™</li>
                <li>å¤‰æ›´ãŒå®Œäº†ã—ãŸã‚‰ã€å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã€Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ãã‚Œãã‚Œ <code>event_news.json</code> / <code>news.json</code> ã¨ç½®ãæ›ãˆã¦ãã ã•ã„</li>
                <li>ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¾ã™</li>
            </ol>
        </div>

        <a href="index.html" class="back-link">â† ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

    <script>
        const NEWS_Key = 'pol_news_data';
        const EVENT_Key = 'pol_event_data';

        let newsData = [];
        let eventData = [];

        document.addEventListener('DOMContentLoaded', async () => {
            // ä»Šæ—¥ã®æ—¥ä»˜ã‚»ãƒƒãƒˆ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('news-date').value = today;
            document.getElementById('event-date').value = today;

            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            await Promise.all([
                loadData(NEWS_Key, 'news.json', d => { newsData = d; renderList('admin-news-list', newsData, deleteNewsItem); }),
                loadData(EVENT_Key, 'event_news.json', d => { eventData = d; renderList('admin-event-list', eventData, deleteEventItem); })
            ]);
        });

        async function loadData(storageKey, jsonFile, callback) {
            try {
                const stored = localStorage.getItem(storageKey);
                if (stored) {
                    callback(JSON.parse(stored));
                } else {
                    const res = await fetch(`${jsonFile}?t=${Date.now()}`);
                    if (res.ok) {
                        const data = await res.json();
                        callback(data);
                        localStorage.setItem(storageKey, JSON.stringify(data));
                    } else {
                        callback([]);
                    }
                }
            } catch (e) {
                console.error(e);
                callback([]);
            }
        }

        function renderList(elementId, data, deleteFunc) {
            const el = document.getElementById(elementId);
            if (data.length === 0) {
                el.innerHTML = '<p style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            el.innerHTML = data.map((item, i) => `
                <div class="admin-news-item">
                    <div class="admin-news-info">
                        <span class="admin-news-date">${item.date}</span>
                        <span class="admin-news-content">${item.content}</span>
                    </div>
                    <button class="btn-delete" onclick="${deleteFunc.name}(${i})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        // --- News Functions ---
        window.addNewsItem = () => addItem('news', newsData, NEWS_Key, () => renderList('admin-news-list', newsData, deleteNewsItem));
        window.deleteNewsItem = (i) => deleteItem(i, newsData, NEWS_Key, () => renderList('admin-news-list', newsData, deleteNewsItem));

        // --- Event Functions ---
        window.addEventItem = () => addItem('event', eventData, EVENT_Key, () => renderList('admin-event-list', eventData, deleteEventItem));
        window.deleteEventItem = (i) => deleteItem(i, eventData, EVENT_Key, () => renderList('admin-event-list', eventData, deleteEventItem));

        // Generic Add
        function addItem(prefix, dataArray, storageKey, renderCb) {
            const dateInput = document.getElementById(`${prefix}-date`);
            const contentInput = document.getElementById(`${prefix}-content`);
            const date = dateInput.value.replace(/-/g, '.');
            const content = contentInput.value.trim();

            if (!content) return alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            dataArray.unshift({ date, content });
            localStorage.setItem(storageKey, JSON.stringify(dataArray));
            renderCb();

            contentInput.value = '';
            alert('è¿½åŠ ã—ã¾ã—ãŸï¼');
        }

        // Generic Delete
        function deleteItem(index, dataArray, storageKey, renderCb) {
            if (!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            dataArray.splice(index, 1);
            localStorage.setItem(storageKey, JSON.stringify(dataArray));
            renderCb();
        }

        // Generic Download
        window.downloadJSON = (data, filename) => {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };
    </script>
</body>

</html>